# Core HUD Implementation

**Date:** 2025-12-28
**Epic:** Main Game UI: Core HUD
**PR:** #93

## Summary

Implemented the main gameplay HUD with TimeSystem for game time management, TopBar with date/time display and speed controls, GameplayBar with category dropdowns, enhanced colonist list with mood tints and double-click to follow, and floating zoom controls.

## What Was Accomplished

### TimeSystem (ECS)
- Created `TimeSystem` as centralized game time/speed state
- `GameSpeed` enum: Paused, Normal (1x), Fast (3x), VeryFast (10x)
- `Season` enum with automatic advancement based on elapsed days
- `effectiveTimeScale()` method for time-scaled systems
- Updated `NeedsDecaySystem` to use TimeSystem instead of hardcoded scale

### Top Bar
- `DateTimeDisplay` component: "Day 15, Summer | 14:32" format
- `SpeedButton` component with active state indicator (underline)
- `TopBar` view with horizontal layout: date/time, speed buttons, menu button
- SVG icons for speed controls (pause, play variants)
- Keyboard hotkeys: Space (pause toggle), 1/2/3 (speed levels)

### Gameplay Bar
- `GameplayBar` view with 4 category dropdowns
- Categories: Actions, Build, Production, Furniture
- Uses `DropdownButton` with `openUpward` flag
- Build dropdown connects to existing BuildMenu flow
- B key toggles build mode

### Colonist List Enhancements
- Status tint background based on mood thresholds
- Green (>70%), Yellow (40-70%), Red (<40%)
- Double-click detection for follow functionality
- `onColonistFollowed` callback for camera centering

### Zoom Controls
- `ZoomControlPanel` wrapper for viewport positioning
- Reset button with `onZoomReset` callback
- SVG icons for zoom in/out/reset
- Home key triggers zoom reset

### UI Restructure
- Split `GameOverlay` into `DebugOverlay` and `ZoomControlPanel`
- Deleted `GameOverlay` and `BuildToolbar` (replaced by new components)
- All new components use Layer system with `addChild()` + `LayerHandle`
- Consistent theme-based styling throughout

## Files Created

**ECS:**
- `libs/engine/ecs/systems/TimeSystem.h/cpp`

**Adapters/Models:**
- `apps/world-sim/scenes/game/ui/adapters/TimeAdapter.h/cpp`
- `apps/world-sim/scenes/game/ui/models/TimeModel.h/cpp`

**Components:**
- `apps/world-sim/scenes/game/ui/components/DateTimeDisplay.h/cpp`
- `apps/world-sim/scenes/game/ui/components/SpeedButton.h/cpp`

**Views:**
- `apps/world-sim/scenes/game/ui/views/TopBar.h/cpp`
- `apps/world-sim/scenes/game/ui/views/GameplayBar.h/cpp`
- `apps/world-sim/scenes/game/ui/views/DebugOverlay.h/cpp`
- `apps/world-sim/scenes/game/ui/views/ZoomControlPanel.h/cpp`

**Assets:**
- `apps/world-sim/assets/ui/icons/*.svg` (speed and zoom icons)

## Files Deleted

- `apps/world-sim/scenes/game/ui/views/GameOverlay.h/cpp`
- `apps/world-sim/scenes/game/ui/views/BuildToolbar.h/cpp`

## Files Modified

- `libs/engine/ecs/systems/NeedsDecaySystem.h/cpp` - Uses TimeSystem
- `libs/ui/components/button/Button.h/cpp` - Added icon support
- `libs/ui/components/dropdown/DropdownButton.h/cpp` - Added openUpward, chevron
- `apps/world-sim/scenes/game/ui/components/ZoomControl.h/cpp` - Reset button, icons
- `apps/world-sim/scenes/game/ui/components/ColonistListItem.cpp` - Mood tints
- `apps/world-sim/scenes/game/ui/views/ColonistListView.h/cpp` - Double-click detection
- `apps/world-sim/scenes/game/ui/GameUI.h/cpp` - Integrated new components
- `apps/world-sim/scenes/game/GameScene.cpp` - Registered TimeSystem, hotkeys

## Technical Decisions

### Layer System Adoption
All new HUD components use the Layer system pattern:
- Constructor creates children via `addChild()` returning `LayerHandle`
- `getChild<T>(handle)` for typed access
- Component automatically renders children
- This replaces manual unique_ptr management

### Time Architecture
TimeSystem is the single source of truth for game time:
- Other systems call `effectiveTimeScale()` to get scaled delta time
- This allows consistent pause/speed behavior across all systems
- UI queries through TimeAdapter → TimeModel → TopBar

### Upward Dropdowns
GameplayBar uses `openUpward: true` for dropdowns:
- Menus expand above the bar (at bottom of screen)
- Prevents occlusion by screen edge

## Deferred Items

- **Scrollable colonist list**: Not needed at current scale
- **A/Q/R hotkeys**: Conflict with WASD camera movement
- These can be added in future if needed

## Related Documentation

- Spec: `/docs/design/main-game-ui-design.md`
- Plan: `/docs/development-log/plans/2025-12-28-core-hud-plan.md`
